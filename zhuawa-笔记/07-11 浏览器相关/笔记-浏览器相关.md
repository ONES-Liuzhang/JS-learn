# 0711 æµè§ˆå™¨ç›¸å…³

## æµè§ˆå™¨å†…ç½®å¯¹è±¡ DOM

TODOï¼š ç¨å¾®çœ‹ä¸€ä¸‹ API æœ‰ä¸€ä¸ªå°è±¡ï¼›

## æµè§ˆå™¨äº‹ä»¶è¯·æ±‚æ¨¡å‹ BOM

### äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·

```js
// ç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤ä¸ºfalseå†’æ³¡äº‹ä»¶ï¼›ä¸ºtrueæ—¶ä¸ºæ•è·äº‹ä»¶
element.addEventListener("click", fn, false);
```

- ç¦æ­¢äº‹ä»¶ä¼ æ’­ï¼š el.stopPropagation() IE<=8 ä¸å…¼å®¹
- ç¦æ­¢å…ƒç´ è‡ªå®šä¹‰äº‹ä»¶ï¼š el.preventDefault() å¸¸è§äº a æ ‡ç­¾

### å®ç°ä¸€ä¸ªäº‹ä»¶ä»£ç†

æ¦‚å¿µï¼šåˆ©ç”¨äº‹ä»¶æ•è·æŠŠå­å…ƒç´ ä¸Šçš„äº‹ä»¶ä»£ç†åˆ°çˆ¶å…ƒç´ ä¸Š
`e.target`å’Œ`e.currentTarget`æœ‰ä»€ä¹ˆåŒºåˆ«

- e.target æŒ‡å‘ç”¨æˆ·çœŸå®ç‚¹å‡»åˆ°çš„é‚£ä¸ªå…ƒç´ 
- e.currentTarget æŒ‡ç»‘å®šäº†è¯¥äº‹ä»¶çš„å…ƒç´ ï¼Œè¿™ä¸ªä¾‹å­é‡Œä¸º ul å…ƒç´ 

```js
let ulList = document.getElementById("ul-list");
// ç‚¹å‡»ulä¸‹çš„li è¾“å‡ºå…¶ä½ç½®å’Œå€¼
ulList.addEventListener(
  "click",
  (e) => {
    const target = e.target;
    if (target.tagName.toLowerCase() === "li") {
      let index = Array.indexOf.call(this.querySelectorAll("li"), target);
      console.log(`ç‚¹å‡»ç¬¬${index}ä¸ªå…ƒç´ ï¼Œå€¼ä¸º ${target.innerText}`);
    }
  },
  true
);
```

### ç”±äºå…¼å®¹æ€§é—®é¢˜ï¼Œå°è£…ä¸€ä¸ªæ¥è¿›è¡Œäº‹ä»¶æ“ä½œçš„å¯¹è±¡ BOM

- addEventListener / removeEventListener
  - æ”¯æŒå†’æ³¡å’Œæ•è·
  - æ”¯æŒæ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†å™¨ï¼ŒæŒ‰æ·»åŠ é¡ºåºè§¦å‘
- attachEvent / detachEvent
  - IE8 ä»¥å‰çš„å®ç°ï¼Œåªæ”¯æŒæ•è·
  - æ”¯æŒæ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†å™¨ï¼ŒæŒ‰æ·»åŠ é¡ºåºçš„é€†åºè§¦å‘ _ï¼Ÿï¼Ÿï¼ŸçœŸçš„å‘_

#### å…¼å®¹æ€§ï¼š

ç°ä»£æµè§ˆå™¨å¤§éƒ¨åˆ†éƒ½æ”¯æŒ`addEventListener`ï¼Œä½†`IE<=8`ä¸æ”¯æŒï¼Œè¦ä½¿ç”¨`attachEvent`æ¥æ·»åŠ äº‹ä»¶ï¼›

> IE<=8 instead only supports the [proprietary .attachEvent() method](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener) . It also does not support the [capture phase](https://www.w3.org/TR/DOM-Level-3-Events/#event-flow) of DOM event dispatch; it only supports event bubbling.

addEventListener -> attachEvent(IE) -> ç›´æ¥èµ‹å€¼

å¦‚æœæ›´å¤è€çš„æµè§ˆå™¨ä¸æ”¯æŒ attachEventï¼Œå¯ä»¥é€šè¿‡ç›´æ¥ä¸ºå…ƒç´ èµ‹å€¼äº‹ä»¶ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒè¯¥å½¢å¼ [çº¢å®ä¹¦ P495 ]
ç¼ºé™·ï¼š å¦‚æœè¿™æ®µä»£ç å‡ºç°åœ¨å…ƒç´ ä¹‹åï¼Œå¯èƒ½å¯¼è‡´ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ²¡æœ‰ååº”çš„æƒ…å†µ

```js
el = document.getElementById("btn");
el.onclick = function () {};
```

#### ä½¿ç”¨åŒºåˆ«

##### addEventListener

- æ”¯æŒä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªä¸ºå†’æ³¡/æ•è·é˜¶æ®µè§¦å‘äº‹ä»¶ï¼›
- å›è°ƒå‡½æ•°ä¸­çš„ this æŒ‡å‘æ­£åœ¨`å¤„ç†äº‹ä»¶`çš„é‚£ä¸ª DOM å¯¹è±¡ï¼Œ**å› ä¸ºå­˜åœ¨å†’æ³¡å’Œæ•è·ï¼Œthis ä¸ä¸€å®šæ˜¯å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œä½†å¯é€šè¿‡ event.target æ¥è·å–å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ **ï¼›
- ç¬¬ä¸€ä¸ªå‚æ•°ä¼ `click`ï¼Œ`input`ç­‰äº‹ä»¶å

##### attachEvent

- åªæ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä»…æ”¯æŒå†’æ³¡ï¼Œä¸æ”¯æŒæ•è·äº‹ä»¶(æµè§ˆå™¨ä¸æ”¯æŒ)
- å›è°ƒå‡½æ•°ä¸­çš„ this æ°¸è¿œæŒ‡å‘ windowï¼›
- ç¬¬ä¸€ä¸ªå‚æ•°ä¸º`onclick`ï¼Œ`oninput`ç­‰ï¼Œå‰é¢è¦å¤šåŠ ä¸€ä¸ª on

```js
class BomEvent {
  constructor(el) {
    this.element = el;
  }

  addEvent(type, event) {
    let el = this.element;
    if (el.addEventListener) {
      el.addEventListener(type, event, false);
    } else if (el.attachEvent) {
      el.attachEvent("on" + type, event);
    } else {
      el["on" + type] = event;
    }
  }

  removeEvent(type, event) {
    let el = this.element;
    if (el.removeEventListener) {
      el.removeEventListener(type, event);
    } else if (el.detachEvent) {
      el.detachEvent("on" + type, event);
    } else {
      el["on" + type] = event;
    }
  }
}

// preventDefault
function preventDefault(ev) {
  if (ev.preventDefault) {
    ev.preventDefault();
  } else {
    ev.returnValue = true;
  }
}

// stopPropagation
function stopPropagation(ev) {
  if (ev.stopPropagation) {
    ev.stopPropagation();
  } else {
    ev.cancelBubble = true; // ä»…ä»…é’ˆå¯¹äºå†’æ³¡ åŸºæœ¬é€‚ç”¨äºæ‰€æœ‰æµè§ˆå™¨ï¼Œå…¼å®¹IEï¼ŒIEåªæœ‰å†’æ³¡
  }
}
```

#### DOM å…ƒç´ ä¸Šç›´æ¥ç»‘å®š onclick

```html
<div onclick="clickHandler"></div>
<script>
  function clickHandler(e) {
    console.log(this); // è¿™é‡Œçš„thisæŒ‡å‘window
  }
</script>
```

#### äº‹ä»¶å¯¹è±¡ Event

äº‹ä»¶å¯¹è±¡åŒ…å«ä¸€äº›å…¬å…±å±æ€§å’Œæ–¹æ³• [çº¢å®ä¹¦ P499]
å¸¸è§çš„ï¼š

- bubbles è¡¨ç¤ºäº‹ä»¶æ˜¯å¦å†’æ³¡ Boolean
- cancelable è¡¨ç¤ºæ˜¯å¦å¯ä»¥å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸º Boolean
- defaultPrevented true è¡¨ç¤ºå·²ç»è°ƒç”¨ preventDefault()æ–¹æ³•
- currentTarget å½“å‰äº‹ä»¶å¤„ç†ç¨‹åºæ‰€åœ¨çš„å…ƒç´  _ç»‘å®šäº‹ä»¶çš„å…ƒç´ _ äº‹ä»¶ä¸­çš„ this æŒ‡å‘çš„å¯¹è±¡
- target äº‹ä»¶ç›®æ ‡ï¼Œ_è§¦å‘äº‹ä»¶çš„å…ƒç´ _
- preventDefault å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸º: ä»£è¡¨ a æ ‡ç­¾çš„ href -> IE æä¾› returnValue = true æ¥å–æ¶ˆé»˜è®¤è¡Œä¸º
- stopPropagation å–æ¶ˆäº‹ä»¶ä¼ é€’
- stopImmediatePropagation å–æ¶ˆäº‹ä»¶ä¼ é€’ï¼Œå¹¶é˜»æ­¢è°ƒç”¨ä»»ä½•åç»­äº‹ä»¶å¤„ç†å™¨ TODO: å’Œ stopPropagation çš„å·®åˆ«ï¼Ÿ
- type è¢«è§¦å‘äº‹ä»¶çš„ç±»å‹ click mouseover mouseout â€¦ ç­‰
- â€¦

IE äº‹ä»¶å¯¹è±¡å±æ€§

- cancelBubble æ˜¯å¦å–æ¶ˆå†’æ³¡
- returnValue æ˜¯å¦é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸º

# æµè§ˆå™¨è¯·æ±‚ç›¸å…³

## XMLHttpRequest

```js
const xhr = new XMLHttpRequest();
// GETè¯·æ±‚
xhr.open("GET", "http://xxxx?a=1&b=2");
xhr.send();
// POSTè¯·æ±‚
xhr.open("POST", "http://xxxx");
xhr.setHeaders("Content-Type", "application/x-www-formurlencoded");
xhr.send({});

// è¯·æ±‚çŠ¶æ€
xhr.onreadystatechange = function () {
  if (xhr.readyState !== 4) {
    return;
  }
  // å¦‚æœè¯·æ±‚è¶…æ—¶ï¼Œxhr.readyStateä¾ç„¶ä¼šæ˜¯4ï¼Œä½†æ˜¯åœ¨è°ƒç”¨xhr.statusä¼šæŠ¥é”™ï¼Œæ‰€ä»¥éœ€è¦åŒ…è£¹try/catch
  try {
    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
      console.log(xhr.responseText);
    } else {
      console.error(`è¯·æ±‚å¤±è´¥${xhr.status}`);
    }
  } catch (err) {}
};

// è¶…æ—¶ XHR Level2è§„èŒƒ
xhr.timeout = 3000;
// ontimeoutäº‹ä»¶
xhr.ontimeout = function () {
  console.error("è¯·æ±‚è¶…æ—¶ï¼");
};

// onprogressäº‹ä»¶
xhr.upload.onprogress = function (p) {
  console.log(Math.round(p.loaded / p.total / 100) + "%");
};

// loadäº‹ä»¶ï¼Œå“åº”æ¥æ”¶å®Œæˆåç«‹å³è°ƒç”¨ï¼Œç®€åŒ–çŠ¶æ€åˆ¤æ–­ï¼Œä¸éœ€è¦å†åˆ¤æ–­readyState
// å¯èƒ½æœ‰å…¼å®¹é—®é¢˜
xhr.onload = function () {
  if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
    console.log(xhr.responseText);
  } else {
    console.error(`è¯·æ±‚å¤±è´¥${xhr.status}`);
  }
};
```

1. xhr è¯·æ±‚ä¸­æ­¢

```js
xhr.abort();
```

2. xhr.onreadystatechange äº‹ä»¶è¦æ”¾åœ¨ xhr.send()ä¹‹å‰ï¼Œ å¦åˆ™å½“è¯·æ±‚æ—¶é•¿å¾ˆçŸ­æ—¶å¯èƒ½æ— æ³•ç›‘å¬åˆ°å˜åŒ–

3. çŠ¶æ€åˆ¤æ–­
   Xhr.status ä¸º 2xx æ—¶æ˜¾ç„¶æ˜¯æ­£ç¡®è·å–åˆ°äº†æ•°æ®ï¼Œè¿˜æœ‰ status ä¸º 304 æ—¶ä¹Ÿéœ€è¦åˆ¤æ–­ï¼Œ304 è¡¨ç¤ºèµ„æºæœªä¿®æ”¹ï¼Œä»æµè§ˆå™¨çš„ç¼“å­˜ä¸­æ‹¿å–çš„æ•°æ®

```js
if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
  // æˆåŠŸé€»è¾‘
}
```

4. get è¯·æ±‚

- å¸¸è§é”™è¯¯ï¼šå­—ç¬¦ä¸²æ ¼å¼ä¸å¯¹
- æŸ¥è¯¢å­—ç¬¦ä¸²ï¼š æ¯ä¸ªåå’Œå€¼éƒ½å¿…é¡»ä½¿ç”¨ encodeURIComponent()ç¼–ç 

```js
function addURIParams(url, name, value) {
  url += url.indexOf("?") > -1 ? "&" : "?";
  url += encodeURIComponent(name) + "=" + encodeURIComponent(value);
}
```

5. post è¯·æ±‚

- è®¾ç½® Headerï¼Œå¸¸è§çš„
- `Content-Type`: `application/json` json ç±»å‹
- `Content-Type`: `x-www-formurlencoded` æäº¤è¡¨å•æ—¶ä½¿ç”¨çš„æ•°æ®ç±»å‹

## fetch

XMLHttpRequest å¯ä»¥é€‰æ‹©åŒæ­¥æˆ–è€…å¼‚æ­¥ï¼Œè€Œ fetch å¿…é¡»æ˜¯å¼‚æ­¥
fetch(url, init)

1. æ¥æ”¶ä¸€ä¸ªå¿…ä¼ çš„å‚æ•° inputï¼Œè¿”å›ä¸€ä¸ª Promise

```js
fetch(url, {
  method: "GET",
  body: {},
  headers: {},
}).then((response) => {
  // è¯»å–å“åº”æ–‡æœ¬
  response.text().then((data) => {
    console.log(data);
  });
  // è¯»å–json
  response.json().then((data) => {
    console.log(data);
  });
});
```

2. æˆåŠŸè·å–è¯·æ±‚ response.status === 200 ; response.statusText === â€œOKâ€

3. é‡å®šå‘æ—¶è¿”å›çš„çŠ¶æ€ç ä¾ç„¶æ˜¯ 200 ä¸æ˜¯ 3xx; ä¼šè®¾ç½®å±æ€§ response.redirected ä¸º trueï¼›

4. å°±ç®—è¯·æ±‚å¤±è´¥ï¼Œå³è¿”å›çš„çŠ¶æ€ç ä¸æ˜¯ 200ï¼ŒPromise ä¾ç„¶ä¼š resolve ç»“æœï¼Œè€Œä¸æ˜¯ catch
   åªè¦æœåŠ¡å™¨æˆåŠŸçš„å°† response è¿”å›åˆ°å®¢æˆ·ç«¯ï¼ŒPromise éƒ½ä¼šè¢« resolve

5. ä»€ä¹ˆæƒ…å†µä¸‹ä¼š catchï¼Ÿ
   åªæœ‰åœ¨æœåŠ¡å™¨æœªå“åº”å¯¼è‡´æµè§ˆå™¨è¶…æ—¶ï¼Œæˆ–è¿å CORSï¼Œæ— ç½‘ç»œè¿æ¥ï¼ŒHTTPS é”™é…åŠå…¶ä»–æµè§ˆå™¨/ç½‘ç»œé—®é¢˜æ‰ä¼šå¯¼è‡´æœŸçº¦è¢«æ‹’ç»ã€‚å³ reject

6. é‚£æ€ä¹ˆåˆ¤æ–­è¯·æ±‚æ˜¯å¦çœŸçš„æˆåŠŸäº†ï¼Ÿ
   é€šè¿‡ response.status === 200ï¼› ä»¥åŠ response.statusText === â€œOKâ€æ¥åˆ¤æ–­

7. æ€ä¹ˆä¸­æ–­ fetch è¯·æ±‚ï¼Ÿ
   é€šè¿‡`AbortController/AbortSignal`ä¸­æ–­è¯·æ±‚ã€‚

```js
const abortController = new AbortController();
fetch("xxx.zip", {
  signal: abortController,
})
  .then((response) => {})
  .catch((err) => {
    console.log(err);
  });

setTimeout(() => {
  abourtController.abort();
}, 10);
```

8. fetch æ²¡æœ‰ timeoutï¼Œæ€ä¹ˆè®¾ç½®è¶…æ—¶ï¼Ÿ

```js
function fetchWithTimeout(url, init, timeout) {
  return new Promise((resolve, reject) => {
    fetch(url, init).then(resolve).catch(reject);
    setTimeout(reject, timeout);
  });
}
```

9. fetch é»˜è®¤æ˜¯ä¸å¸¦ cookie çš„è¯·æ±‚ï¼Œæ€ä¹ˆæºå¸¦ cookieï¼Ÿ
   é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°çš„é…ç½®é¡¹ init.credentials

- same-origin åŒæºæºå¸¦ cookie é»˜è®¤å€¼
- include æ‰€æœ‰è¯·æ±‚å‡æºå¸¦ cookie
- omit ä¸å‘é€ cookie

```js
fetch(url, {
  method: "GET",
  credentials: "same-origin", // åŒåŸŸä¼šæºå¸¦cookie
});
```

### åŒæºæ”¿ç­– CORS(Cross-Origin Resource Sharing)

æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ä¹‹ä¸€ï¼Œé˜²æ­¢è·¨åŸŸè„šæœ¬æ”»å‡»(XSS Cross Site Script)

- ç®€å•è¯·æ±‚ ä¼šåŒ…å«ä¸€ä¸ª Origin è¡¨ç¤ºè¯·æ±‚æº
  - ä¸åŒ…å«è‡ªå®šä¹‰ headerï¼Œ
  - è¯·æ±‚ä½“æ˜¯ text/plain ç±»å‹
- å¤æ‚è¯·æ±‚ æ»¡è¶³ä¸‹é¢å…¶ä¸­ä¸€æ¡ï¼Œå°±ä¼šé¦–å…ˆå‘æœåŠ¡å™¨å‘é€é¢„æ£€è¯·æ±‚ OPTIONS
  - POSTã€GET ä¹‹å¤–çš„æ–¹æ³•
  - åŒ…å«è¯·æ±‚çš„è‡ªå®šä¹‰å¤´éƒ¨
  - ä¸åŒè¯·æ±‚ä½“å†…å®¹ç±»å‹ï¼ˆé text/plainï¼‰

åŒºåˆ«ï¼šç®€å•è¯·æ±‚ç›´æ¥æŠŠå®é™…è¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨åšæ ¡éªŒï¼Œè€Œå¤æ‚è¯·æ±‚ä¸ä¼šå‘é€å®é™…çš„è¯·æ±‚ä½“ï¼Œè€Œæ˜¯å…ˆå‘é€ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼ŒåŒ…å«å®é™…è¯·æ±‚çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œæ¥è¯¢é—®æœåŠ¡å™¨è¯¥è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚

ç›¸åŒç‚¹ï¼šæœåŠ¡å™¨ä¼šæ ¹æ®ä¸Šè¿°è§„åˆ™æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦è¦ä¸ºå…¶æä¾›å“åº”

#### å¤æ‚è¯·æ±‚çš„è¯·æ±‚å¤´

- Origin: ä¸ç®€å•è¯·æ±‚ç›¸åŒ
- Access-Control-Request-Method è¯·æ±‚çš„æ–¹æ³• GETã€POST ç­‰
- Access-Control-Request-Headers è‡ªå®šä¹‰å¤´éƒ¨åˆ—è¡¨
  é¢„æ£€è¯·æ±‚è¯·æ±‚å¤´ï¼š

```js
 Origin: http://lz.com.cn
 Access-Control-Request-Methods: POST, GET
 Access-Control-Request-Headers: My-Header
```

#### æœåŠ¡å™¨å“åº”å¤´

- Access-Control-Allow-Origin ä¸ç®€å•è¯·æ±‚ç›¸åŒ
- Access-Control-Allow-Methods
- Access-Control-Allow-Headers å…è®¸çš„å¤´éƒ¨
- Access-Control-Max-Age é¢„æ£€è¯·æ±‚çš„ç¼“å­˜ç§’æ•°
  æœåŠ¡å™¨å“åº”å¤´ï¼š

```js
 Access-Control-Allow-Origin: http://lz.com.cn
 Access-Control-Allow-Methods: POST, GET
 Access-Control-Allow-Headers: My-Header
 Access-Control-Max-Age: 1728000
```

### ajax çš„å°è£…

### å¸¸è§çŠ¶æ€ç 

200 get æˆåŠŸ
201 post æˆåŠŸ

301 æ°¸ä¹…é‡å®šå‘
302 ä¸´æ—¶é‡å®šå‘
304 åå•†ç¼“å­˜ ğŸŒŸ

400 å®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨è¯†åˆ«
403 Forbidden æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡/å¯èƒ½æ˜¯è·¨åŸŸ
404 è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨
405 è¯·æ±‚çš„ method ä¸å…è®¸
500 æœåŠ¡å™¨å†…éƒ¨å‘ç”Ÿé”™è¯¯

### åå•†ç¼“å­˜

### å°è£…ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œå¤„ç†å¯¹å¼‚æ­¥å‡½æ•°çš„è¶…æ—¶

```
// å°è£…ä¸€ä¸ªå·¥å…·å‡½æ•°å¤„ç†å¼‚æ­¥å‡½æ•°çš„è¶…æ—¶
function asyncWithTimeout(asyncFn, wait) {
  return function () {
    let timer;
    return new Promise((resolve, reject) => {
      Promise.resolve(asyncFn.apply(null, arguments)).then(
        (res) => {
          clearTimer(timer);
          resolve(res);
        },
        (reason) => {
          clearTimer(timer);
          reject(reason);
        }
      );

      timer = setTimeout(() => {
        reject("å‡½æ•°æ‰§è¡Œè¶…æ—¶ï¼");
      }, wait);
    });
  };
  function clearTimer(timer) {
    if (timer) {
      clearTimeout(timer);
      timer = null;
    }
  }
}

const newFn = asyncWithTimeout(asyncFn, 3000);

newFn("asyncFn")
  .then((name) => {
    console.log(`å‡½æ•°${name}æ‰§è¡Œå®Œæ¯•`);
  })
  .catch((e) => {
    console.log(e);
  });

```

## XMLHttpRequest å’Œ fetch çš„å·®å¼‚

1. å‚æ•°å·®å¼‚
   - xhr.open(method, url, false) -> xhr.send(data)
   - fetch(url, init)
2. è°ƒç”¨æ–¹å¼å·®å¼‚
   - XMLHttpRequest ä½¿ç”¨äº‹ä»¶ç›‘å¬ï¼›
   - fetch ä½¿ç”¨ Promiseï¼›
3. è¿”å›çŠ¶æ€ç å·®å¼‚
   - XMLHttpRequest å¯ä»¥é€šè¿‡ response.status æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ 200-300 ä¹‹é—´æˆ–è€… 304 éƒ½è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼›
   - fetch è·Ÿéšé‡å®šå‘æ—¶ä¹Ÿä¼šè¿”å›çŠ¶æ€ 200ï¼Œä¸ä¼šè¿”å›çŠ¶æ€ç  300-399
4. HTTP çŠ¶æ€æè¿° statusText
   - XMLHttpRequest çš„ statusText åœ¨è·¨æµè§ˆå™¨çš„æƒ…å†µä¸‹ä¸å¯é ï¼Œä¸€èˆ¬ä¸é€šè¿‡å®ƒåˆ¤æ–­è¯·æ±‚
   - fetch çš„ statusText å¯ä»¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ(æ˜¯å¦ä¸º 200) response.statusText === â€œokâ€
5. å¼‚æ­¥è¯·æ±‚çš„å–æ¶ˆ abort
   - XMLHttpRequest æä¾› api xhr.abort() æ¥å–æ¶ˆè¯·æ±‚
   - fetch: ç”¨ AbortController æ¥æ§åˆ¶
6. timeout
   - XMLHttpRequest é€šè¿‡äº‹ä»¶æ¥ç›‘å¬è¶…æ—¶ xhr.timeout = 3000 -> xhr.ontimeout = function() {}ï¼Œ_XMLHttpRequest_ å°±ç®—è¶…æ—¶ï¼Œæœ€ç»ˆ readyState è¿˜æ˜¯ä¼šç­‰äº 4ï¼Œä½†æ˜¯è·å– xhr.status ä¼šæŠ¥é”™ï¼Œéœ€è¦ä½¿ç”¨ try/catch é€»è¾‘
   - fetch æ²¡æœ‰æä¾› timeout apiï¼Œè¦æ‰‹åŠ¨å®ç° timeout
7. Cookie
   - è·¨åŸŸæƒ…å†µä¸‹è¯·æ±‚é»˜è®¤éƒ½ä¸ä¼šåŒ…å« Cookie
